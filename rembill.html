<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calicut University Bill (Exact Format)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #eef2f5; padding: 20px; color: #333; }
        .container { max-width: 1100px; margin: 0 auto; background: white; padding: 40px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        h1 { text-align: center; color: #2c3e50; font-size: 24px; margin-bottom: 5px; }
        .subtitle { text-align: center; color: #7f8c8d; font-size: 14px; margin-bottom: 30px; }

        .section-header { 
            background: #2c3e50; color: white; padding: 10px 15px; 
            font-weight: bold; margin-top: 25px; border-radius: 4px; 
            display: flex; justify-content: space-between; align-items: center;
        }
        
        .grid-personal { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
        .full-width { grid-column: span 2; }
        
        .form-group { margin-bottom: 5px; }
        label { display: block; font-size: 11px; font-weight: bold; margin-bottom: 3px; color: #555; }
        input, select { width: 100%; padding: 8px; border: 1px solid #cbd5e0; border-radius: 4px; font-size: 13px; box-sizing: border-box; }
        input:focus { border-color: #3498db; outline: none; }

        /* Table Styling */
        .table-wrapper { overflow-x: auto; margin-top: 10px; border: 1px solid #e2e8f0; border-radius: 4px; }
        table { width: 100%; border-collapse: collapse; min-width: 900px; font-size: 12px; }
        th { background: #f8f9fa; text-align: left; padding: 10px; border-bottom: 2px solid #ddd; font-weight: 600; font-size: 11px; }
        td { padding: 8px; border-bottom: 1px solid #eee; }
        td input { width: 100%; border: 1px solid transparent; background: #fdfdfd; }
        td input:hover, td input:focus { border: 1px solid #ccc; background: white; }
        
        .btn { background: #2c3e50; color: white; border: none; padding: 12px 25px; border-radius: 4px; font-size: 16px; cursor: pointer; margin-top: 30px; width: 100%; transition: 0.2s; }
        .btn:hover { background: #34495e; }
        .btn-add { background: #27ae60; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 11px; margin: 10px; }
        .btn-del { background: #e74c3c; color: white; border: none; width: 24px; height: 24px; border-radius: 50%; cursor: pointer; font-size: 12px; line-height: 24px; text-align: center; padding: 0; }

        .total-display { text-align: right; font-weight: bold; padding: 10px; background: #f8f9fa; border-top: 2px solid #ddd; }
    </style>
</head>
<body>

<div class="container">
    <h1>University of Calicut Remuneration Bill</h1>
    <div class="subtitle">Complete Format including all Valuation and Practical Columns</div>

    <div class="form-group">
        <label>Exam Name (Source 1)</label>
        <input type="text" id="examName" value="4th Semester M. Sc. Botany Degree Core Examinations">
    </div>

    <div class="section-header">1. Personal Details</div>
    <div class="grid-personal">
        <div class="form-group"><label>1a. Name</label><input type="text" id="p_name" value="SURESH V"></div>
        <div class="form-group"><label>1b. Teacher ID</label><input type="text" id="p_id" value="SBO114459"></div>
        
        <div class="form-group"><label>2a. Designation & Pay</label><input type="text" id="p_desig" value="Assistant Professor, 95300/-"></div>
        <div class="form-group"><label>2b. Institution Type</label><input type="text" id="p_type" value="Govt."></div>
        
        <div class="form-group full-width"><label>3. Office Address</label><input type="text" id="p_off" value="Department of Botany, Govt. Victoria College, Palakkad"></div>
        <div class="form-group full-width"><label>Home Address</label><input type="text" id="p_home" value="Nedumani, Nenmeni PO, Kollengode, Palakkad - 678506"></div>
        
        <div class="form-group"><label>5. Disbursing Officer</label><input type="text" id="p_disburse" value="Principal, Govt. Victoria College, Palakkad"></div>
        <div class="form-group"><label>4. Mobile No</label><input type="text" id="p_mob" value="8547363449"></div>
        
        <div class="form-group"><label>6. Email ID</label><input type="text" id="p_email" value="sureshmagnolia@gmail.com"></div>
        <div class="form-group"><label>7. Bank A/C No</label><input type="text" id="p_acc" value="30003630389"></div>
        
        <div class="form-group"><label>8. Bank & Branch</label><input type="text" id="p_bank" value="SBI, Victoria College Road"></div>
        <div class="form-group"><label>9. IFS Code</label><input type="text" id="p_ifs" value="SBIN0012886"></div>
        
        <div class="form-group"><label>10. PAN</label><input type="text" id="p_pan" value="DPKPS8489M"></div>
    </div>

    <div class="section-header">11. QP Setting <button class="btn-add" onclick="addQP()">+ Add</button></div>
    <div class="table-wrapper">
        <table id="t_qp">
            <thead>
                <tr>
                    <th width="20%">Programme</th>
                    <th width="30%">Course Details</th>
                    <th width="10%">No. QPs</th>
                    <th width="10%">No. Keys</th>
                    <th width="12%">Amt (QPs)</th>
                    <th width="12%">Amt (Keys)</th>
                    <th width="6%"></th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <div class="section-header">12. Valuation / Revaluation (Detailed) <button class="btn-add" onclick="addVal()">+ Add</button></div>
    <div class="table-wrapper">
        <table id="t_val">
            <thead>
                <tr>
                    <th style="min-width:150px">Paper</th>
                    <th>Scripts(a)</th>
                    <th>Min(b)</th>
                    <th>Remun (a-b) (P)</th>
                    <th>Discussion (Q)</th>
                    <th>Handling (R)</th>
                    <th>Picked/Reval (S)</th>
                    <th>Remun (S)</th>
                    <th width="6%"></th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <div class="section-header">13. Practicals / Viva (Detailed) <button class="btn-add" onclick="addPrac()">+ Add</button></div>
    <div class="table-wrapper">
        <table id="t_prac">
            <thead>
                <tr>
                    <th style="min-width:150px">Batch</th>
                    <th>Prescribe(P)</th>
                    <th>Prepare(Q)</th>
                    <th>Conduct(R)</th>
                    <th>Records(S)</th>
                    <th>Viva(T)</th>
                    <th width="6%"></th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <button class="btn" onclick="generate()">Generate Exact PDF</button>
</div>

<script>
    // --- INIT ROWS ---
    // Pre-populate with user context data
    window.onload = function() {
        addQP("BSC BOTANY HONORS", "BOTIMN103 ECONOMIC BOTANY", 1, 1, 1000, 0);
        // Add empty rows for others just to show structure
        addVal("", 0, 0, 0, 0, 0, 0, 0);
        addPrac("", 0, 0, 0, 0, 0);
    };

    function addQP(prog="", course="", qp=1, keys=1, amtQ=0, amtK=0) {
        let row = `<tr>
            <td><input type="text" value="${prog}"></td>
            <td><input type="text" value="${course}"></td>
            <td><input type="number" value="${qp}"></td>
            <td><input type="number" value="${keys}"></td>
            <td><input type="number" value="${amtQ}"></td>
            <td><input type="number" value="${amtK}"></td>
            <td><button class="btn-del" onclick="del(this)">×</button></td>
        </tr>`;
        document.querySelector("#t_qp tbody").insertAdjacentHTML('beforeend', row);
    }

    function addVal(paper="", a=0, b=0, p=0, q=0, r=0, s=0, remS=0) {
        let row = `<tr>
            <td><input type="text" value="${paper}" placeholder="Paper Name"></td>
            <td><input type="number" value="${a}" title="Scripts Valued"></td>
            <td><input type="number" value="${b}" title="Mandatory Min"></td>
            <td><input type="number" value="${p}" title="Remun (P)"></td>
            <td><input type="number" value="${q}" title="Discussion (Q)"></td>
            <td><input type="number" value="${r}" title="Handling (R)"></td>
            <td><input type="number" value="${s}" title="No. Picked (S)"></td>
            <td><input type="number" value="${remS}" title="Remun S"></td>
            <td><button class="btn-del" onclick="del(this)">×</button></td>
        </tr>`;
        document.querySelector("#t_val tbody").insertAdjacentHTML('beforeend', row);
    }

    function addPrac(batch="", p=0, q=0, r=0, s=0, t=0) {
        let row = `<tr>
            <td><input type="text" value="${batch}" placeholder="Batch Name"></td>
            <td><input type="number" value="${p}" title="Prescribing"></td>
            <td><input type="number" value="${q}" title="Preparing"></td>
            <td><input type="number" value="${r}" title="Conducting"></td>
            <td><input type="number" value="${s}" title="Records"></td>
            <td><input type="number" value="${t}" title="Viva"></td>
            <td><button class="btn-del" onclick="del(this)">×</button></td>
        </tr>`;
        document.querySelector("#t_prac tbody").insertAdjacentHTML('beforeend', row);
    }

    function del(btn) { btn.closest('tr').remove(); }

    // --- PDF GENERATION ---
    function generate() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // 1. HEADER
        doc.setFont("helvetica", "bold");
        doc.setFontSize(14);
        doc.text("UNIVERSITY OF CALICUT", 105, 12, { align: "center" });
        
        doc.setFontSize(10);
        doc.setFont("helvetica", "normal");
        doc.text("REMUNERATION BILL for Setting of Question papers, Valuation of answer papers of", 105, 18, { align: "center" });
        doc.text("Theory/Practical Examinations, Revaluation/Picking out and Despatching of answer papers of", 105, 23, { align: "center" });
        
        doc.setFont("helvetica", "bold");
        doc.setFontSize(11);
        doc.text(document.getElementById('examName').value, 105, 30, { align: "center" });

        // 2. PERSONAL GRID (Exact Replication)
        const v = (id) => document.getElementById(id).value;
        const startY = 35;
        
        // We use AutoTable to draw the exact box lines
        doc.autoTable({
            startY: startY,
            theme: 'plain', // Clean lines
            styles: { 
                lineColor: [0, 0, 0], 
                lineWidth: 0.15, 
                fontSize: 9, 
                cellPadding: 3, 
                textColor: 0,
                valign: 'top'
            },
            body: [
                [
                    { content: `1 a Name: ${v('p_name')}`, styles: { fontStyle: 'bold' } },
                    { content: `b Teacher ID: ${v('p_id')}` }
                ],
                [
                    { content: `2 a Designation & Pay: ${v('p_desig')}` },
                    { content: `b Type: ${v('p_type')}` }
                ],
                [
                    { content: `3 OFFICE ADDRESS:\n${v('p_off')}`, colSpan: 1 },
                    { content: `HOME ADDRESS:\n${v('p_home')}`, colSpan: 1 }
                ],
                [
                    { content: `5. Disbursing Officer: ${v('p_disburse')}` },
                    { content: `4. Mobile Number: ${v('p_mob')}` }
                ],
                [
                    { content: `6. E-mail ID: ${v('p_email')}` },
                    { content: `7. Bank A/C Number: ${v('p_acc')}` }
                ],
                [
                    { content: `8. Bank and Branch: ${v('p_bank')}` },
                    { content: `9. IFS Code: ${v('p_ifs')}` }
                ],
                [
                    { content: `10. PAN: ${v('p_pan')}`, colSpan: 2 }
                ]
            ],
            columnStyles: {
                0: { cellWidth: 95 },
                1: { cellWidth: 95 }
            }
        });

        let currentY = doc.lastAutoTable.finalY + 5;

        // 3. TABLE 11 (QP SETTING)
        doc.setFont("helvetica", "bold");
        doc.setFontSize(10);
        doc.text("*11 For setting question papers", 14, currentY);
        
        // Header Structure based on Source [6]
        const head11 = [
            [
                { content: 'Name of Programme', rowSpan: 2, styles: { valign: 'middle' } },
                { content: 'Details of Courses / QP', rowSpan: 2, styles: { valign: 'middle' } },
                { content: 'No. of Items', colSpan: 2, styles: { halign: 'center' } },
                { content: 'Remuneration (Rs.)', colSpan: 2, styles: { halign: 'center' } }
            ],
            ['QPs', 'Keys', 'For QPs', 'For Keys']
        ];

        let body11 = [];
        let total11 = 0;
        document.querySelectorAll('#t_qp tbody tr').forEach(tr => {
            let i = tr.querySelectorAll('input');
            let qpAmt = parseFloat(i[4].value) || 0;
            let keyAmt = parseFloat(i[5].value) || 0;
            total11 += (qpAmt + keyAmt);
            body11.push([i[0].value, i[1].value, i[2].value, i[3].value, qpAmt || '', keyAmt || '']);
        });

        doc.autoTable({
            startY: currentY + 2,
            head: head11,
            body: body11,
            theme: 'grid',
            headStyles: { fillColor: [255, 255, 255], textColor: 0, lineColor: 0, lineWidth: 0.1 },
            styles: { lineColor: 0, lineWidth: 0.1, fontSize: 8 }
        });

        currentY = doc.lastAutoTable.finalY + 5;
        doc.text(`Total QP Remuneration: Rs. ${total11}/-`, 140, currentY, { align: 'right' });
        currentY += 8;

        // 4. TABLE 12 (VALUATION) - Adding Missing Columns [Source 8, 9, 10]
        doc.text("*12 For Valuation/Revaluation/Picking out/Despatching", 14, currentY);

        const head12 = [
            ['Name of Programme', 'No. Scripts (a)', 'Mand. Min (b)', 'Remun (a-b)\n(P)', 'Discussion\n(Q)', 'Handling\n(R)', 'Picked/Reval\n(S)', 'Remun S', 'Total\n(P+Q+R+S)']
        ];
        
        let body12 = [];
        let total12 = 0;
        document.querySelectorAll('#t_val tbody tr').forEach(tr => {
            let i = tr.querySelectorAll('input');
            // Indices: 0=Paper, 1=A, 2=B, 3=P, 4=Q, 5=R, 6=S, 7=RemS
            let p = parseFloat(i[3].value) || 0;
            let q = parseFloat(i[4].value) || 0;
            let r = parseFloat(i[5].value) || 0;
            let remS = parseFloat(i[7].value) || 0;
            let rowTot = p + q + r + remS;
            total12 += rowTot;
            
            if(i[0].value || rowTot > 0) { // Only add if data exists
                body12.push([i[0].value, i[1].value, i[2].value, p, q, r, i[6].value, remS, rowTot]);
            }
        });

        doc.autoTable({
            startY: currentY + 2,
            head: head12,
            body: body12,
            theme: 'grid',
            headStyles: { fillColor: [255, 255, 255], textColor: 0, lineColor: 0, lineWidth: 0.1 },
            styles: { lineColor: 0, lineWidth: 0.1, fontSize: 8 }
        });
        
        // 5. TABLE 13 (PRACTICALS) - Adding Missing Columns [Source 11]
        currentY = doc.lastAutoTable.finalY + 10;
        doc.text("*13 For Practical / Viva", 14, currentY);

        const head13 = [
            ['Batch/Work', 'Prescribing\n(P)', 'Preparing\n(Q)', 'Conducting\n(R)', 'Records\n(S)', 'Viva\n(T)', 'Total\n(P+Q+R+S+T)']
        ];

        let body13 = [];
        let total13 = 0;
        document.querySelectorAll('#t_prac tbody tr').forEach(tr => {
            let i = tr.querySelectorAll('input');
            let p = parseFloat(i[1].value) || 0;
            let q = parseFloat(i[2].value) || 0;
            let r = parseFloat(i[3].value) || 0;
            let s = parseFloat(i[4].value) || 0;
            let t = parseFloat(i[5].value) || 0;
            let rowTot = p + q + r + s + t;
            total13 += rowTot;

            if(i[0].value || rowTot > 0) {
                body13.push([i[0].value, p, q, r, s, t, rowTot]);
            }
        });

        doc.autoTable({
            startY: currentY + 2,
            head: head13,
            body: body13,
            theme: 'grid',
            headStyles: { fillColor: [255, 255, 255], textColor: 0, lineColor: 0, lineWidth: 0.1 },
            styles: { lineColor: 0, lineWidth: 0.1, fontSize: 8 }
        });

        // 6. FINAL TOTAL & CERTIFICATE
        let grandTotal = total11 + total12 + total13;
        currentY = doc.lastAutoTable.finalY + 15;
        
        doc.setFontSize(11);
        doc.setFont("helvetica", "bold");
        doc.text(`Grand Total: Rs. ${grandTotal}/-`, 14, currentY);

        currentY += 15;
        doc.setFontSize(9);
        doc.setFont("helvetica", "bold");
        doc.text("Certificate", 105, currentY, { align: "center" });
        
        doc.setFont("helvetica", "normal");
        const cert = "Certified that the amount in this bill has not been claimed previously and it is paid to me provisionally and I shall refund to the university any amount received which is subsequently disallowed by audit.";
        const splitCert = doc.splitTextToSize(cert, 180);
        doc.text(splitCert, 14, currentY + 5);

        // Signatures
        currentY += 30;
        doc.text("Signature of Chairperson", 14, currentY);
        doc.text("Signature of Claimant", 150, currentY);

        doc.save('Calicut_Univ_Bill_Exact.pdf');
    }
</script>

</body>
</html>
