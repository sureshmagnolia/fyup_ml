<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calicut Univ Bill - FIXED</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        :root { --primary: #003366; --border: #ccc; }
        body { font-family: 'Arial', sans-serif; background: #e9ecef; padding: 20px; font-size: 13px; }
        .app-container { max-width: 1000px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--primary); padding-bottom: 10px; margin-bottom: 20px; }
        .version-tag { font-family: monospace; font-size: 11px; color: #666; background: #eee; padding: 4px 8px; border-radius: 4px; }
        
        h2 { margin: 0; color: var(--primary); font-size: 18px; }
        .section-title { background: #f1f3f5; padding: 8px 12px; font-weight: bold; border-left: 4px solid var(--primary); margin: 20px 0 10px 0; }
        
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        
        label { display: block; font-size: 11px; font-weight: bold; margin-bottom: 4px; color: #495057; }
        input { width: 100%; padding: 6px; border: 1px solid var(--border); border-radius: 3px; box-sizing: border-box; }
        
        /* Table Input Styling */
        .table-input-wrapper { overflow-x: auto; border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; min-width: 900px; font-size: 11px; }
        th { background: #f8f9fa; border: 1px solid #dee2e6; padding: 8px; text-align: center; }
        td { border: 1px solid #dee2e6; padding: 0; }
        td input { border: none; padding: 8px; width: 100%; border-radius: 0; }
        td input:focus { background: #e7f1ff; outline: none; }
        
        .btn-row { display: flex; gap: 10px; justify-content: flex-end; margin-top: 10px; }
        .btn { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .btn-add { background: #28a745; color: white; }
        .btn-del { background: #dc3545; color: white; width: 30px; }
        .btn-gen { background: var(--primary); color: white; width: 100%; font-size: 16px; padding: 15px; margin-top: 30px; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header">
        <h2>Remuneration Bill Generator</h2>
        <span class="version-tag" id="verDisplay">App Version: FIX-DEBUG-V4</span>
    </div>

    <div class="grid-2">
        <div><label>Name of Examination</label><input type="text" id="examName" value="4th Semester M. Sc. Botany Degree Core Examinations"></div>
        <div><label>Semester / Header Line</label><input type="text" id="semName" value="4th Semester M. Sc."></div>
    </div>

    <div class="section-title">1. Claimant Details (Dr. Suresh V)</div>
    <div class="grid-2">
        <div><label>1a. Name</label><input type="text" id="p_name" value="SURESH V"></div>
        <div><label>1b. Teacher ID</label><input type="text" id="p_id" value="SBO114459"></div>
        <div><label>2a. Designation & Pay</label><input type="text" id="p_desig" value="Assistant Professor, 95300/-"></div>
        <div><label>2b. Govt/Aided</label><input type="text" id="p_type" value="Govt."></div>
        <div><label>3. Office Address</label><input type="text" id="p_off" value="Department of Botany, Govt. Victoria College, Palakkad"></div>
        <div><label>Home Address</label><input type="text" id="p_home" value="Nedumani, Nenmeni PO, Kollengode, Palakkad - 678506"></div>
        <div><label>4. Mobile</label><input type="text" id="p_mob" value="8547363449"></div>
        <div><label>5. Disbursing Officer</label><input type="text" id="p_disburse" value="Principal, Govt. Victoria College, Palakkad"></div>
        <div><label>6. Email</label><input type="text" id="p_email" value="sureshmagnolia@gmail.com"></div>
        <div><label>7. Bank A/C</label><input type="text" id="p_acc" value="30003630389"></div>
        <div><label>8. Bank & Branch</label><input type="text" id="p_bank" value="SBI, Victoria College Road"></div>
        <div><label>9. IFS Code</label><input type="text" id="p_ifs" value="SBIN0012886"></div>
        <div><label>10. PAN</label><input type="text" id="p_pan" value="DPKPS8489M"></div>
    </div>

    <div class="section-title">11. QP Setting</div>
    <div class="table-input-wrapper">
        <table id="t_qp">
            <thead>
                <tr>
                    <th>Programme</th><th>Course Details</th><th>No. Items</th><th>Rate</th><th>Total</th><th></th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <div class="btn-row"><button class="btn btn-add" onclick="addQP()">+ Add QP Work</button></div>

    <div class="section-title">12. Valuation / Revaluation</div>
    <div class="table-input-wrapper">
        <table id="t_val">
            <thead>
                <tr>
                    <th width="15%">Paper</th><th>From-To</th><th>Dur</th><th>Scripts(a)</th><th>Min(b)</th>
                    <th>Rate(P)</th><th>Disc(Q)</th><th>Hand(R)</th><th>Pick(S)</th><th>Rem(S)</th><th>Total</th><th></th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <div class="btn-row"><button class="btn btn-add" onclick="addVal()">+ Add Valuation</button></div>

    <div class="section-title">13. Practicals / Viva</div>
    <div class="table-input-wrapper">
        <table id="t_prac">
            <thead>
                <tr>
                    <th width="15%">Batch</th><th>Reg/Pres</th>
                    <th>Presc(P)</th><th>Prep(Q)</th><th>Cond(R)</th><th>Rec(S)</th><th>Viva(T)</th><th>Total</th><th></th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <div class="btn-row"><button class="btn btn-add" onclick="addPrac()">+ Add Practical</button></div>

    <button class="btn btn-gen" onclick="generateReplica()">Generate PDF</button>
</div>

<script>
    const APP_VERSION = "Trace-ID: DOC-20251210-WA0009_REV_4_DEBUG";

    function addQP() {
        const row = `<tr>
            <td><input type="text" value="BSC BOTANY HONORS"></td>
            <td><input type="text" value="BOTIMN103 ECONOMIC BOTANY"></td>
            <td><input type="number" value="1"></td>
            <td><input type="number" value="1000"></td>
            <td><input type="number" value="1000" class="qp-tot" readonly></td>
            <td><button class="btn btn-del" onclick="this.closest('tr').remove()">×</button></td>
        </tr>`;
        document.querySelector('#t_qp tbody').insertAdjacentHTML('beforeend', row);
    }

    function addVal() {
        const row = `<tr>
            <td><input type="text" placeholder="Paper"></td>
            <td><input type="text"></td>
            <td><input type="text"></td>
            <td><input type="number" value="0"></td>
            <td><input type="number" value="0"></td>
            <td><input type="number" value="0"></td>
            <td><input type="number" value="0"></td>
            <td><input type="number" value="0"></td>
            <td><input type="number" value="0"></td>
            <td><input type="number" value="0"></td>
            <td><input type="number" value="0" class="val-tot" readonly></td>
            <td><button class="btn btn-del" onclick="this.closest('tr').remove()">×</button></td>
        </tr>`;
        document.querySelector('#t_val tbody').insertAdjacentHTML('beforeend', row);
    }

    function addPrac() {
        const row = `<tr>
            <td><input type="text" placeholder="Batch"></td>
            <td><input type="number"></td>
            <td><input type="number" value="0"></td>
            <td><input type="number" value="0"></td>
            <td><input type="number" value="0"></td>
            <td><input type="number" value="0"></td>
            <td><input type="number" value="0"></td>
            <td><input type="number" value="0" class="prac-tot" readonly></td>
            <td><button class="btn btn-del" onclick="this.closest('tr').remove()">×</button></td>
        </tr>`;
        document.querySelector('#t_prac tbody').insertAdjacentHTML('beforeend', row);
    }

    window.onload = function() { addQP(); addVal(); addPrac(); };

    // --- PDF GENERATOR ---
    function generateReplica() {
        // ERROR HANDLING BLOCK
        if (!window.jspdf) {
            alert("Error: PDF Library not loaded. Please check your internet connection.");
            return;
        }

        try {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Helper to get Element Value safely
            const v = (id) => {
                const el = document.getElementById(id);
                return el ? el.value : "";
            };

            // ================= PAGE 1 =================
            doc.setFont("helvetica", "bold");
            doc.setFontSize(14);
            doc.text("UNIVERSITY OF CALICUT", 105, 12, {align:"center"});
            
            doc.setFontSize(10);
            doc.setFont("helvetica", "normal");
            doc.text("REMUNERATION BILL for Setting of Question papers, Valuation of answer papers of", 105, 17, {align:"center"});
            doc.text("Theory/Practical Examinations, Revaluation/Picking out and Despatching of answer papers of", 105, 22, {align:"center"});
            
            doc.setFont("helvetica", "bold");
            doc.setFontSize(11);
            doc.text(v('semName'), 105, 28, {align:"center"});
            doc.text(v('examName'), 105, 33, {align:"center"});

            // 2. Personal Grid
            const pBody = [
                [{content: `1 a Name of QP setter/Examiner/Chief/Chairperson (in block letters)\n   ${v('p_name')}`, styles:{fontStyle:'bold'}}, {content: `b Calicut University Teacher Unique ID No.\n   ${v('p_id')}`}],
                [{content: `2 a Designation and Basic Pay: ${v('p_desig')}`}, {content: `b. Tick whether Govt/Aided/Self Financing: ${v('p_type')}`}],
                [{content: `3 OFFICE ADDRESS: (IN BLOCK LETTERS)\n   ${v('p_off')}`, colSpan:1}, {content: `HOME: (IN BLOCK LETTERS)\n   ${v('p_home')}`, colSpan:1}],
                [{content: `4 Mobile Number: ${v('p_mob')}`}, {content: `6 E-mail ID: ${v('p_email')}`}],
                [{content: `5. Name of the disbursing Officer (Treasury Officer/Principal)\n   ${v('p_disburse')}`}, {content: `7. Bank A/C Number: ${v('p_acc')}`}],
                [{content: `8 Bank and Branch: ${v('p_bank')}`}, {content: `9. IFS Code: ${v('p_ifs')}`}],
                [{content: `10 Permanent Account Number (PAN): ${v('p_pan')}`, colSpan:2}]
            ];

            doc.autoTable({
                startY: 36,
                body: pBody,
                theme: 'plain',
                styles: { lineColor: [0,0,0], lineWidth: 0.15, fontSize: 8, cellPadding: 2, textColor: 0 },
                columnStyles: { 0: {cellWidth: 95}, 1: {cellWidth: 95} }
            });

            let y = doc.lastAutoTable.finalY + 4;

            // 3. TABLE 11 (QP)
            doc.setFont("helvetica", "bold");
            doc.text("*11 For setting question papers", 14, y);
            y += 2;

            let qpRows = [];
            let grandQP = 0;
            document.querySelectorAll('#t_qp tbody tr').forEach(tr => {
                const i = tr.querySelectorAll('input');
                const amt = parseFloat(i[4].value) || 0;
                grandQP += amt;
                qpRows.push([i[0].value, i[1].value, i[2].value, "", amt.toFixed(2)]);
            });
            qpRows.push([{content: 'Total:', colSpan: 3, styles: {halign: 'right', fontStyle: 'bold'}}, "", grandQP.toFixed(2)]);

            doc.autoTable({
                startY: y,
                head: [[
                    {content:'Name of the\nProgramme', rowSpan:2}, 
                    {content:'Details of Courses and\nquestion papers', rowSpan:2}, 
                    {content:'No. of Answer keys\nNo. of QP set', colSpan:2}, 
                    {content:'Remuneration (Rs.)\nFor QPs     For Keys', colSpan:1}
                ]],
                body: qpRows,
                theme: 'grid',
                headStyles: {fillColor:[255,255,255], textColor:0, lineColor:0, lineWidth:0.1, halign:'center', fontSize:8},
                styles: {lineColor:0, lineWidth:0.1, fontSize: 8},
            });
            
            y = doc.lastAutoTable.finalY + 6;

            // 4. TABLE 12 (VALUATION)
            doc.setFont("helvetica", "bold");
            doc.text("*12 For Valuation/Revaluation/Picking out/Despatching of answer papers", 14, y);
            y += 2;

            let valRows = [];
            let grandVal = 0;
            document.querySelectorAll('#t_val tbody tr').forEach(tr => {
                const i = tr.querySelectorAll('input');
                const tot = parseFloat(i[10].value) || 0;
                grandVal += tot;
                if (i[0].value || tot > 0) {
                    valRows.push([
                        i[0].value, i[1].value, i[2].value, i[3].value, i[4].value, 
                        i[5].value, i[6].value, i[7].value, 
                        i[8].value, i[9].value, tot.toFixed(2)
                    ]);
                }
            });

            doc.autoTable({
                startY: y,
                head: [
                    [
                        {content:'Name of Programme', rowSpan:2}, 
                        {content:'False No.\nanswer scripts', rowSpan:2}, 
                        {content:'Duration', rowSpan:2}, 
                        {content:'No Scripts\n(a)', rowSpan:2}, 
                        {content:'Mandatory\nMin (b)', rowSpan:2}, 
                        {content:'Remuneration (Rs.)', colSpan:6}
                    ],
                    ['(a-b)\n(P)', 'Disc.\n(Q)', 'Handl.\n(R)', 'Picked\n(S)', 'Remun\nS', 'Total\n(P+Q+R+S)']
                ],
                body: valRows,
                theme: 'grid',
                headStyles: {fillColor:[255,255,255], textColor:0, lineColor:0, lineWidth:0.1, halign:'center', fontSize:7},
                styles: {lineColor:0, lineWidth:0.1, fontSize: 7, halign: 'center'},
                columnStyles: {0: {halign: 'left'}}
            });

            y = doc.lastAutoTable.finalY + 6;

            // 5. TABLE 13 (PRACTICALS)
            doc.setFont("helvetica", "bold");
            doc.setFontSize(10);
            doc.text("*13. For practical/viva Examinations of ....................", 14, y);
            y += 2;

            let pracRows = [];
            let grandPrac = 0;
            document.querySelectorAll('#t_prac tbody tr').forEach(tr => {
                const i = tr.querySelectorAll('input');
                const tot = parseFloat(i[7].value) || 0;
                grandPrac += tot;
                if (i[0].value || tot > 0) {
                    pracRows.push([i[0].value, i[1].value, i[2].value, i[3].value, i[4].value, i[5].value, i[6].value, tot.toFixed(2)]);
                }
            });

            doc.autoTable({
                startY: y,
                head: [
                    [
                        {content:'No. of Batches', rowSpan:2}, 
                        {content:'No. of Candidates\nReg / Pres', rowSpan:2}, 
                        {content:'Remuneration for', colSpan:6}
                    ],
                    ['Prescribing\n(P)', 'Preparing\n(Q)', 'Conducting\n(R)', 'Records\n(S)', 'Viva\n(T)', 'Total']
                ],
                body: pracRows,
                theme: 'grid',
                headStyles: {fillColor:[255,255,255], textColor:0, lineColor:0, lineWidth:0.1, halign:'center', fontSize:7},
                styles: {lineColor:0, lineWidth:0.1, fontSize: 7, halign: 'center'},
                columnStyles: {0: {halign: 'left'}}
            });

            // 6. TOTAL & CERTIFICATE
            y = doc.lastAutoTable.finalY + 10;
            const finalTotal = grandQP + grandVal + grandPrac;
            
            doc.setFontSize(11);
            doc.setFont("helvetica", "bold");
            doc.text(`Grant Total of Theory and Practicals: Rs. ${finalTotal.toFixed(2)}/-`, 14, y);
            
            y += 8;
            doc.setFont("helvetica", "normal");
            doc.setFontSize(9);
            doc.text("14 Name and signature of", 14, y);
            
            y += 8;
            doc.text("Chairperson", 40, y);
            doc.text("Chief Examiner", 80, y);
            doc.text("Additional Examiner", 120, y);
            doc.text("QP setter", 160, y);
            
            y += 10;
            doc.setFont("helvetica", "bold");
            doc.text("Certificate", 105, y, {align: 'center'});
            
            y += 5;
            doc.setFont("helvetica", "normal");
            const certText = "Certified that the amount in this bill has not been claimed previously and it is paid to me provisionally and I shall refund to the university any amount received which is subsequently disallowed by audit.";
            doc.text(doc.splitTextToSize(certText, 180), 14, y);
            
            doc.setFontSize(7);
            doc.setTextColor(150);
            doc.text(APP_VERSION + " - PG 1", 195, 290, {align:'right'});
            doc.setTextColor(0);

            // ================= PAGE 2 =================
            doc.addPage();
            
            doc.setFontSize(10);
            doc.text("Contents received", 14, 20);
            doc.text("Signature of the Examiner/Chief/Chairperson/ QP Setter with date", 120, 20, {align:'center'});

            doc.setDrawColor(0);
            doc.rect(140, 30, 40, 30);
            doc.setFontSize(8);
            doc.text("Affix Revenue\nstamp for claims\nexceeding\nRs. 5000/-", 160, 45, {align: 'center'});

            doc.autoTable({
                startY: 70,
                head: [[{content: 'FOR OFFICE USE ONLY (Pareeksha Bhavan)', colSpan: 2, styles: {halign: 'center', fontStyle: 'bold'}}]],
                body: [
                    ['1. Received ............ QPs / Answer keys / Mark Sheets', '2. No. of Answer scripts revalued/picked/dispatched...'],
                    [{content: 'Signature of SO/AR/CE with Date:\nDesignation:', colSpan: 2}]
                ],
                theme: 'grid',
                styles: {lineColor: 0, lineWidth: 0.1, cellPadding: 4}
            });
            
            doc.autoTable({
                startY: doc.lastAutoTable.finalY + 5,
                head: [[{content: 'Pre-Audit/ Payment by Finance Branch', colSpan: 4, styles: {halign: 'center', fontStyle: 'bold'}}]],
                body: [
                [{content: 'Rs. ............................... (Rupees .......................................................................... only)\nfound admissible and passed for payment/paid', colSpan: 4}],
                ['\nAsst.', '\nS.O.', '\nAR/DR/JR/FO', 'Payment by Pareeksha Bhaven\nPaid the amount passed for payment'] 
                ],
                theme: 'grid',
                styles: {lineColor: 0, lineWidth: 0.1, cellPadding: 4}
            });

            // INSTRUCTIONS
            y = doc.lastAutoTable.finalY + 10;
            doc.setFontSize(10);
            doc.setFont("helvetica", "bold");
            doc.text("Important instructions to Examiners/ Chief / Chairpersons / QP setters", 14, y);
            y += 6;
            
            doc.setFont("helvetica", "normal");
            doc.setFontSize(9);
            const instructions = [
                "1. The teachers drawing UGC scale pay shall value the mandatory number of answerscripts as part of duty without any remuneration.",
                "2. The examiners are not eligible for reimbursement of any expenses with respect to the picking out and dispatching of answerscripts over and above the remuneration fixed.",
                "3. The examiners are eligible for TA/DA for attending CV camps as per rules.",
                "4. Revenue stamp is to be affixed in the bill when the total amount exceeds Rs 5000/-.",
                "5. The remuneration will be sanctioned by the University and credited directly to the Bank account mentioned in the bill.",
                "6. The payment of remuneration by this office is an income for the purpose of income tax. This may be included in the taxable income while computing annual income.",
                "7. For further details Examiners are requested to refer the University Orders issued from time to time."
            ];
            
            instructions.forEach(txt => {
                const split = doc.splitTextToSize(txt, 180);
                doc.text(split, 14, y);
                y += (split.length * 5) + 2;
            });
            
            y += 5;
            doc.setFont("helvetica", "bold");
            doc.text("Additional Instructions to QP Setters", 14, y);
            y += 6;
            doc.setFont("helvetica", "normal");
            
            const qpInst = [
                "1. The Chairman of Board of Question Papers may claim Chairman's fee, Postage and Stationery charges (enclosing signed vouchers) etc. in his bill.",
                "2. All question paper setters should forward their remuneration bills to the Controller of Examinations through the Chairperson, as soon as the QP setting work is over.",
                "3. All remuneration bills must bear the signature of the Chairperson. If there is no separate Chairperson, the fact may be noted in the space provided.",
                "4. The chairperson must forward all the remuneration bills of the QP setting board in one lot within one month positively."
            ];

            qpInst.forEach(txt => {
                const split = doc.splitTextToSize(txt, 180);
                doc.text(split, 14, y);
                y += (split.length * 5) + 2;
            });

            doc.setFontSize(7);
            doc.setTextColor(150);
            doc.text(APP_VERSION + " - PG 2", 195, 290, {align:'right'});

            doc.save('Calicut_Univ_Remuneration_Bill_Exact.pdf');
        
        } catch(err) {
            alert("An error occurred during PDF generation:\n" + err.message);
            console.error(err);
        }
    }
</script>

</body>
</html>
